function bundle_add(that){var wrt=$(that),selected=wrt.find("option:selected"),text=selected.text(),type=$("#bundledprodctstype").val(),value=wrt.val(),catname=selected.parent().attr("label"),bid=$(".bundle-list li").length;$(".bundle-list .template").clone().removeClass("template").attr("id","bundle_"+value+"_"+bid+"_"+type).find("input").each(function(i){var name=$(this).attr("name");switch(name&&name.length&&name.match(/\[\]$/)&&$(this).attr("name",name.replace(/\[\]$/,"["+bid+"]")),i){case 1:$(this).val(value);break;case 2:$(this).val($("#bundledprodctstype").val());break;default:$(this).val(bid)}}).end().find(".loadname").text(catname+" - "+text).end().find(".edit a").attr("href",("Addon"==type?"?cmd=productaddons&action=addon&id=":"?cmd=services&action=product&id=")+value).end().appendTo(".bundle-list"),wrt.val(0),wrt.trigger("chosen:updated")}function bundle_remove(that){var item=$(that).parents(".bundled-item"),id=item.attr("id").replace(/^bundle_/,"");item.remove(),$("#config"+id).remove();var config=$("#bundle_config");config.children(":visible").length||(config.css("min-height","auto"),$(".bundle-items").css("min-height","auto"),$(".bundle-list").removeClass("short"))}function bundle_config(that){var item=$(that).closest(".bundled-item"),postdata={make:"config",id:$("#product_id").val(),cat_id:$("#category_id").val()},bundleid=item.find(".bundle-sort").val();postdata=$.param(postdata)+"&"+item.find("input,select,textarea").serialize();var id=$(that).attr("rel");id&&id.length&&(postdata+="&"+$("#"+id).find("input,select,textarea").serialize()),$("#bundle_ajax").show(),$.post("?cmd=services&action=product",postdata,function(data){$("#bundle_ajax").hide(),$(".bundle-list").addClass("short"),data=$(parse_response(data));var id=data.attr("id"),bundle_items=$(".bundle-items"),config_container=$("#bundle_config"),container=$("#"+id);data.find("input[name], select[name], textarea[name]").addClass("inp").each(function(){var thatt=$(this);thatt.attr("name",thatt.attr("name").replace(/^custom/,"custom["+bundleid+"]"))}),config_container.show().detach().insertAfter(item),bundle_items.find(".bundled-item.active").removeClass("active"),item.addClass("active"),container.length?container.html(data.html()).siblings(":visible").hide().end().show():data.appendTo(config_container).siblings(":visible").hide().end().show(),$(that).attr("rel",id);var height=Math.max(config_container.css("min-height","auto").height(),bundle_items.css("min-height","auto").height());config_container.find(".chosen").chosenedge({width:"100%"}),config_container.css("min-height",height),bundle_items.css("min-height",height),$(".form-disabler",config_container).change()})}function bundle_pricingopt(){var box=$("#pricing_overide"),sw=$("#pricing_overide_switch"),box2=$("#pricing_dynamo");sw.is(":checked")?(box.show(),box2.hide()):(box.hide(),box2.show())}function bundle_optionalconfig(that){var form=$(that).closest(".form-group").find("input, textarea, select").not(that);$(that).is(":checked")?form.attr("disabled","disabled").prop("disabled",!0):form.removeAttr("disabled").prop("disabled",!1)}function bundle_discount(that){var postdata={make:"discount",id:$("#product_id").val(),cat_id:$("#category_id").val()};postdata=$.param(postdata)+"&"+$("#bundle_discount").find("input,select,textarea").serialize(),$.post("?cmd=services&action=product",postdata,function(data){data=$(parse_response(data)),$("#bundle_pricngopt").html(data)})}$("#priceoptions").children().not(".bundle-capsule").remove();var bundle_optgroups=0;$(function(){var products=$("#bundledprodcts");$("#bundledprodctstype").change(function(){switch($(this).val()){case"Domain":var type="Domain";break;case"Addon":var type="Addon";break;default:var type="Product"}0==bundle_optgroups&&(bundle_optgroups=products.children().detach()),products.html(bundle_optgroups.filter("#empty_opt, .group_"+type)).val(0),products.trigger("chosen:updated")}).change(),$("#bundledprodcts").change(function(){bundle_add(this)}).chosenedge({width:"100%",search_contains:!0}),$(".bundle-list").dragsort({dragSelector:"a.sort",placeHolderTemplate:'<li class="list-group-item bundled-item"></li>'})});