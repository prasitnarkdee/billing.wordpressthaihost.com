var HBOpConfig={category:null,template:null,init:function(c,t){HBOpConfig.category=c,HBOpConfig.template=t},callback:[],fsubmit:function(){$(".spinner").show();for(var i=0;i<HBOpConfig.callback.length;i++)"function"==typeof HBOpConfig.callback[i]&&HBOpConfig.callback[i]();return $.get("?cmd=services&action=opconfig&do=saveconfig&"+$("#sform1").serialize(),function(data){parse_response(data),$(document).trigger("close.facebox")}),!1}},premade={filelock:!1,recheck:null,save:function(){$("[id^=old_premade_], #new_premade").hide(),$("input,textarea,select","#sform1").filter(function(){return!$(this).val()||0==$(this).val().length}).prop("disable",!0);var recheck=!1;return $('[id^="file_"]').each(function(i){var ukey=$(this).attr("id"),key=ukey.replace(/file_(.+)_\d+/,"$1");(premade.filelock||$(this).val().length>0)&&(premade.filelock=!0,void 0!=premade.icons[ukey]&&0===premade.icons[ukey]?recheck=!0:void 0===premade.icons[ukey]?(premade.icons[ukey]=0,premade.update(key,ukey,!1),recheck=!0):"string"==typeof premade.icons[ukey]&&(clearTimeout(premade.recheck),$('input[rel="'+ukey+'"]').val(premade.icons[ukey])))}),recheck?(clearTimeout(premade.recheck),premade.recheck=setTimeout(function(){premade.save()},200),!1):($.post("?cmd=services&action=opconfig&do=saveconfig&cat_id="+HBOpConfig.category,$("input,textarea,select","#sform1").serializeArray(),function(){ajax_update("?cmd=services&action=opconfig&tpl="+HBOpConfig.template+"&id="+HBOpConfig.category,{},"#facebox .content")}),!1)},update:function(key,ukey,preview){return preview?($('<div style="position:absolute;top:0px;left:0px;width:250px;" id="preloader"></div>').height($("#icon_"+key).outerHeight()).appendTo($("#icon_"+key)),old=0):(old=$('input[name="opconfig['+key+"]["+ukey.replace(/^[^\d]+/,"")+'][icon]"]').val(),void 0==old&&(old=0)),$.ajaxFileUpload({url:"?cmd=services&action=opconfig&id="+HBOpConfig.category+"&do=ajaxupload",fileElementId:ukey,data:{preview:preview,old:old},dataType:"json",success:function(data,status){if($("#"+ukey).length&&$("[id^=jUploadFile]").detach().replaceAll("#"+ukey).attr("id",ukey),!data.status)return $("#icon_"+key).html(data.errors),preview||(premade.icons[ukey]=-1),!1;if(preview){var stamp=Date.now();$("#icon_"+key).html('<img src="../'+data.url+"?"+stamp+'" alt="icon" />')}else premade.icons[ukey]=data.url;console.log(data.url)},error:premade.up_error}),!1},addnew:function(key){return $('[id^="old_'+key+'_"]').hide(),$("#new_premade").show(),$("#itool_"+key).show(),$("#btn_"+key).text("Add"),!1},edit:function(key,index){return $('[id^="old_'+key+'_"]').hide(),$("#old_"+key+"_"+index).show(),$("#itool_"+key).show(),$("#new_premade").hide(),$("#btn_"+key).text("Change"),$("#icon_"+key).html('<img src="../'+$('input[name="opconfig['+key+"]["+index+'][icon]"]').val()+'" alt="icon" /></div>'),!1},del:function(key,index){return $("#old_"+key+"_"+index).is(":visible")&&$("#itool_"+key).hide(),$("#old_"+key+"_"+index).remove(),$("#plist_premade li").eq(index-1).remove(),!1},up_error:function(){},icons:{}};HBOpConfig.callback.push(premade.save);