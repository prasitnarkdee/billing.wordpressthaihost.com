$(document).bind("fieldLogicLoaded",function(event,fl){$.fieldLogic.getContainer=function(cond){return $(cond.target).closest(".like-table-row")}});var order={cmd:"order",action:"createdraft",update_price:function(price){$(".order_price").text(price.cost),$(".order_setup").text(price.setup),$(".order_cost").text(price.total_cost),gtprice="";for(c in price.recurring)gtprice+=order.cycle[c]+": "+price.recurring_cost[c]+"<br />";$(".order_price_r").html(gtprice)},lock_logic:function(val){return $.fieldLogic&&($.fieldLogic.setLogicLock(val),$(".field-logic-off").toggleClass("label-default-invert").toggleClass("label-default"),$(".field-logic-on").toggleClass("label-success").toggleClass("label-success-invert"),val&&$(".product_form_row").show()),!1},save_details:function(form){form=form||$("#order_details form"),$("#order_details form").addLoader(),ajax_update("?cmd="+order.cmd+"&action="+order.action+"&make=savedetails",form.serializeForm(),"#order_details"),order.get_service($(".order_items").parents("form")[0])},list_items:function(select){$(select).parents("form").addLoader(),ajax_update("?cmd="+order.cmd+"&action="+order.action+"&make=listitems",$(select).parents("form").serializeObject(),function(data){$("#order_item").html(data),$("#preloader").remove()})},get_service:function(form){null==order.delayAction?($("#loadingindyk").show(),order.delayAction=setTimeout(function(){ajax_update("?cmd="+order.cmd+"&action="+order.action+"&make=getservice",$.extend({id:$(".draft_id").eq(0).val()},$(form).serializeObject()),function(data){var resp=parse_response(data);$(form).find(".order_items").html(resp),$("#loadingindyk").hide()})},700)):(clearTimeout(order.delayAction),order.delayAction=null,order.get_service(form))},get_product:function(select){var self=$(select);if("new"==self.val())window.location="?cmd=services&action=addcategory",self.val($("option:first",self).val());else{var form=self.parents("form").eq(0),link=self.next();link.hide(),"-"!=self.val()&&link.attr("href","?cmd=services&action=product&id="+self.val()).show(),form.addLoader(),ajax_update("?cmd="+order.cmd+"&action="+order.action+"&make=getproduct",form.serializeObject(),function(data){var resp=parse_response(data);$(".product_config",form).html(resp),$("#preloader").remove()})}},get_domain:function(select){$("#loadingindyk_add").show();var self=$(select),form=self.parents("form").eq(0),link=self.next();link.hide(),"-"!=self.val()&&link.attr("href","?cmd=services&action=product&id="+self.val()).show(),form.addLoader(),ajax_update("?cmd="+order.cmd+"&action="+order.action+"&make=getdomain",form.serializeObject(),function(data){var resp=parse_response(data);$("#domain_config").html(resp),$("#preloader").remove(),$("#loadingindyk_add").hide(),order.search_domain()})},initFormValues:function(){if($(".like-table-row div[default] input[name^=custom], .like-table-row textarea").each(function(){var initval=$(this).parent().attr("default");initval&&$(this).val(initval)}),$.fieldLogic){var lock=$.fieldLogic.getLogicLock();$(".field-logic-off").toggleClass("label-default-invert",!lock).toggleClass("label-default",lock),$(".field-logic-on").toggleClass("label-success",!lock).toggleClass("label-success-invert",lock)}},additem:function(form){$(form).addLoader();var valid=!0;$.each($(form).context,function(i,v){$(v).is(":visible")&&$(v).prop("required")&&(isEmpty($(v).val())||$(v).is("select")&&0==$(v).val()?(0===$(".error"+i).length&&$(v).parent().append("<span class='error"+i+"' style='color:red'>This field is required</span>"),valid=!1):0!==$(".error"+i).length&&$(".error"+i).remove())}),valid?(ajax_update("?cmd="+order.cmd+"&action="+order.action+"&make=add",$(form).serializeObject(),function(data){order.get_service($(".order_items").parents("form")[0]),$("#preloader").remove()}),"function"==typeof $().slideToElement&&$("body").slideToElement("order_items"),$('#product_config input:not([type="hidden"])').each(function(){$(this).val("")}),$("#product_config select").each(function(){"hidden"!=$(this).attr("name")&&$(this).val($(this).children(":first").val())}),order.initFormValues()):(event.preventDefault(),$(form).hideLoader())},edit:function(form){$(".order_items").addLoader();var valid=!0;$.each($(form).context,function(i,v){$(v).is(":visible")&&$(v).prop("required")&&(isEmpty($(v).val())||$(v).is("select")&&0==$(v).val()?(0===$(".error"+i).length&&$(v).parent().append("<span class='error"+i+"' style='color:red'>This field is required</span>"),valid=!1):0!==$(".error"+i).length&&$(".error"+i).remove())}),valid?ajax_update("?cmd="+order.cmd+"&action="+order.action+"&make=editservice",$(form).serializeObject(),".order_items"):(event.preventDefault(),$(".order_items").hideLoader())},fold:function(el){var rel=$(el).attr("rel");$("."+rel+".foldable").fadeToggle(),$("."+rel+" .foldable").toggle(),$("."+rel+" input.fold").val($("."+rel+" .foldable").eq(0).is(":visible")?0:1)},new_gateway:function(elem){"new"==$(elem).val()&&(window.location="?cmd=managemodules&action=payment",$(elem).val($("option:first",+$(elem)).val()))},check_availability:function(){var token=$('meta[name="csrf-token"]').attr("content");$("#domain_name").is(":visible")?ajax_update("?cmd=orders&action=whois",{security_token:token,domain:$("#domain_name").val()},"#avail_field",!0):ajax_update("?cmd=orders&action=whois",{security_token:token,domain:$("#domain_sld").val()+$("#domain_tld option[value="+$("#domain_tld").val()+"]").text(),type:$("input[name='domain_action']:checked").val()},"#avail_field",!0)},confirm_unsaved:function(msg){return!$("#unsaved").length&&!$(".saved:visible").filter(function(){return"hidden"!=$(this).css("visibility")}).length||confirm(msg)},update_services:function(data){var select=$(".client_services");select.val();$("#client_service").html(""),select.children().eq(0).nextAll().remove();for(var i in data)select.append('<option value="'+i+'">#'+i+" "+data[i]+"</option>");select.val(select)},load_service:function(select){$(select).parents("form").addLoader(),"0"!=$(select).val()&&ajax_update("?cmd="+order.cmd+"&action="+order.action+"&make=getclientservice",{id:$(".draft_id").eq(0).val(),service:$(select).val()},function(data){$("#client_service").html(data),$("#preloader").remove()})},edit_back:function(that){var fold=$(that).parents(".havecontrols").eq(0).find('a[onclick*="order.fold"]:first'),rel=fold.attr("rel");return 1==$("."+rel+" input.fold").val()&&fold.click().next().remove(),$(that).prev().show().focus().prevAll().remove(),$(that).remove(),!1},search_domain:function(){var tld=$("#domain_tld"),sld=$("#domain_sld");"-"!==tld.val()&&""!==sld.val()&&$.get("?cmd=orders&action=search_domain",{tld:tld.val(),sld:sld.val()},function(data){$("#domain-warning").html(data)})},delayAction:null,cycle:{}};