INSERT INTO `hb_reports` (`id`, `type`, `name`, `query`, `options`, `handler`, `state`, `columns`, `displayname`)
VALUES
	(NULL, 'Invoices', 'List of all invoices in given period for certain client group', 'SELECT i.id as `Invoice ID`,\r\n CONCAT(d.firstname,\' \',d.lastname) as `Client`,\r\n hb_currency(i.total,i.currency_id,i.rate) as `Invoice Total`,\r\n i.status as `Invoice Status`,\r\n CASE WHEN hbc.value = \'eu\' \r\nAND i.status = \'Paid\' THEN hb_date(i.datepaid) ELSE hb_date(i.date) END as `Invoice Date`,\r\n hb_currency(i.credit,i.currency_id,i.rate) as `Invoice Credit`,\r\n m.modname as `Gateway Name`,\r\n i.taxrate as `Tax1 rate`,\r\n i.taxrate2 as `Tax2 rate`,\r\n i.tax as `Tax1 Amount`,\r\n i.tax2 as `Tax2 Amount`,\r\n i.rate as `Exchange Rate`,\r\n hb_date(i.duedate) as `Invoice Due Date`,\r\n hb_date(i.datepaid) as `Invoice Paid Date`,\r\n t.trans_id as `Related transaction`,\r\n ca.email as `Client Email`,\r\n d.phonenumber as `Client Phone`,\r\n d.companyname as `Client Company`,\r\n d.city as `Client City`,\r\n d.country as `Client Country`,\r\n d.address1 as `Client Address`,\r\n d.postcode as `Client ZIP` \r\nFROM hb_invoices i \r\nINNER JOIN hb_client_details d ON (i.client_id = d.id) \r\nINNER JOIN hb_client_access ca ON (i.client_id = ca.id) \r\nLEFT JOIN hb_modules_configuration m ON (m.id = i.payment_module) \r\nLEFT JOIN hb_currencies c ON (c.id = i.currency_id) \r\nLEFT JOIN hb_transactions t ON (t.invoice_id = i.id) \r\nLEFT JOIN hb_configuration hbc ON hbc.setting = \'InvoiceModel\' \r\nWHERE\r\n ca.group_id = :group_id \r\nAND i.id NOT IN (SELECT invoice_id \r\nFROM hb_invoice_items \r\nWHERE\r\n `type` = \'Invoice\') \r\nAND i.status NOT IN (\'Draft\', \'Recurring\') \r\nAND i.`date` >= :date_bottom \r\nAND i.`date` <= :date_top \r\n\r\nORDER BY i.id ASC', 1, 'sql', 'a:3:{s:6:\"params\";a:3:{s:9:\":group_id\";s:1:\"0\";s:12:\":date_bottom\";s:21:\"{$current_year_start}\";s:9:\":date_top\";s:20:\"{$current_month_end}\";}s:10:\"conditions\";a:0:{}s:6:\"output\";s:4:\"html\";}', 'a:7:{i:0;s:10:\"Invoice ID\";i:1;s:12:\"Gateway Name\";i:2;s:6:\"Client\";i:3;s:13:\"Invoice Total\";i:4;s:14:\"Invoice Status\";i:5;s:12:\"Invoice Date\";i:6;s:11:\"Client City\";}', 'List of all invoices in given period for certain client group');
